const hre = require("hardhat");

async function main() {
  console.log("ðŸ” Verificando se o desafio foi completado...\n");

  // O endereÃ§o do contrato pode ser passado como variÃ¡vel de ambiente
  // Se nÃ£o fornecido, fazemos o deploy primeiro
  let contractAddress = process.env.CONTRACT_ADDRESS;
  
  if (!contractAddress) {
    console.log("ðŸ“¦ Nenhum endereÃ§o fornecido. Fazendo deploy do contrato...\n");
    
    const [deployer] = await hre.ethers.getSigners();
    const DeployChallenge = await hre.ethers.getContractFactory("DeployChallenge");
    const deployChallenge = await DeployChallenge.deploy();
    await deployChallenge.waitForDeployment();
    contractAddress = await deployChallenge.getAddress();
    
    console.log("âœ… Contrato deployado em:", contractAddress);
    console.log("");
  }

  // Verificar se o contrato estÃ¡ completo
  const DeployChallenge = await hre.ethers.getContractFactory("DeployChallenge");
  const contract = DeployChallenge.attach(contractAddress);

  const isComplete = await contract.isComplete();
  
  console.log("ðŸ“ EndereÃ§o do contrato:", contractAddress);
  console.log("âœ… isComplete():", isComplete);
  
  if (isComplete) {
    console.log("\nðŸŽ‰ Desafio completado! O contrato retorna true para isComplete()");
    console.log("ðŸ’¡ Use este endereÃ§o no site Capture the Ether para verificar a soluÃ§Ã£o");
  } else {
    console.log("\nâŒ O contrato ainda nÃ£o estÃ¡ completo");
  }
}

main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error(error);
    process.exit(1);
  });

